<div class="main_content" style="">
	<form name="frmmonitor" id="frmmonitor" action="#">
	
	<table border="0"
		style="width: 100%; padding: 10px; border-collapse: separate; border-spacing: 10px;">
		<tr>
			<td>
				<div title="team">Team</div> <select name="team" id="team"
				style="width: 200px">
					<option value="RESOLVE">RESOLVE</option>
					<option value="Provisioning">Provisioning</option>
					<option value="Service Checker">Service Checker</option>
			</select>
			</td>
			<td>
				<div title="logfiles">Log Files</div> <span id="logfilescontainer">
					<select name="logfiles" id="logfiles" style="width: 200px"
					multiple="multiple" >						
				</select>
			</span>
			</td>

			<td>
			<td>
				<div title="Merge">Merge</div> 
				
				<div id="merge">
    <input type="radio" id="mergeon" name="merge" value="on" ><label for="mergeon">On</label>
    <input type="radio" id="mergeoff" name="merge" value="off" checked="checked"><label for="mergeoff">Off</label>
    
  </div>
  
				
			</td>

			<td>
			<td class="ralign">
			<div title="submitbtn">&nbsp;</div> 
				<button type="button" class="btnstartmonitor">Start</button>
			</td>
		</tr>
	</table>
</form>
	<div>

		

		<div id="tabs" class="monitortab">
			<ul>
<!-- 				<li><a href="#tabs-1">Tab name</a> <span -->
<!-- 					class="ui-icon ui-icon-close" role="presentation">Remove Tab</span></li> -->
			</ul>
			<!-- <div id="tabs-1">
				<p>tab contents</p>
			</div> -->
		</div>



		<script>

		var tabs;
		   var   tabTemplate = "<li><span class='ui-icon ui-icon-close' role='presentation'>Remove Tab</span> <a href='#{href}'>#{label}</a> </li>",
	      	 tabCounter = 1;
		   
		   
function updatelogfilesmenu(){
	
	//A method get last parameters 
	
	$("#logfilescontainer").html("");
	
	//get selected team
	if($("#team").val() != ""){
		var formdata="team=" + $("#team").val()
			
			
			$.post( "/services/getlogfilesbyserver", formdata)
		 	  .done(function( data ) {
		 	    
		 		 serverxml=""
		 		
		 		//parse xml
		 		  $xml = $( data )
		 		  $status = $xml.find( "status" )
		 		  
		 		  
		 		  
		 		  if( $status.attr("error") =="true"){
		 			  
		 			//  showerror("resultdetailcontainer",$status.attr("description"))
		 			  
		 		  } else{
		 			  
		 			 var tbl=""
							tbl=tbl + ' <select style="width: 380px"  multiple="multiple" id="logfiles">'
							
							var dataCount=0
		 			 $xml.find('logfile').each(function(index){
		  					dataCount++
		  		            var username = $(this).find('name').text();
		  					
		  					
		  					var name =  $(this).find('name').text();
		  	 				var filename =  $(this).find('filename').text();
		  	 				var $hosts =  $(this).find('hosts');
		  	 				var team =  $(this).find('team').text();
		  	 				var fileid =  $(this).find('id').text();
		  	 				//OPtgroup for host
		  	 				tbl=tbl + "<optgroup label='"+name+"' >" 
		  	 			 $hosts.find('host').each(function(index){
		  	 			 
		  	 				var hostname =  $(this).text();
		  	 				 tbl=tbl + "        <option value='"+fileid +";" + hostname+"'>&nbsp;&nbsp;"+hostname+"</option>" 
		  	 				
		  	 				
		  	 			 });
		  	 				tbl=tbl + "</optgroup>" 
		  					
		 			 });
							tbl=tbl + '</select> '
							
							$("#logfilescontainer").html(tbl)
							$("select#logfiles").multipleSelect();
								
		 		  }
		 		 
		 	  });
	 	}
	}
	

function pollog(cursessionid){
	
	//make ajax call
	
		var formdata="sessionid=" +cursessionid
			
			
			$.post( "/services/logpoll", formdata)
		 	  .done(function( data ) {
		 	    
		 		console.log(data)
		 		
		 		//parse xml
		 		  $xml = $( data )
		 		  $status = $xml.find( "status" )
		 		  
		 		  
		 		  
		 		  if( $status.attr("error") =="true"){
		 			  
		 			//  showerror("resultdetailcontainer",$status.attr("description"))
		 			  
		 		  } else{
		 			  var localsessionid=$status.attr("sessionid")
		 			  
		 			$("#div"+localsessionid).append($xml.find( "data" ).text());
		 			 setTimeout(function(){ pollog(localsessionid); }, 5000);
		 			
		 			 
		 		  }
		 		 
		 	  });
	
	
	//on success
		//update content divsessionid
		// Settimeout in 300 millisecs
		
	//on failure
		//update content
		
}

function createtab(localsessionid){
	
	
	// Get sessionid
	//create hidden field with sessionid
	//create html with div & sessionid
	// call an cont
	
	 var label = "Tab " + tabCounter,
     id = "tabs-" + tabCounter,
     li = $( tabTemplate.replace( /#\{href\}/g, "#" + id ).replace( /#\{label\}/g, label ) ),
     
     tabContentHtml = "<div id='' >log here</div>";

   tabs.find( ".ui-tabs-nav" ).append( li );
   tabs.append( "<div style='padding-left:200px'>Highlight  <input type='text' class='tm-input' data-session='" + localsessionid + "'   /><div id='div" + localsessionid + "' style='width:95%;height:800px;overflow:auto' ></div></div>" );
   tabs.tabs( "refresh" );
   //tabs.tabs({ selected: tabCounter });
  // tabs.tabs("option", "selected", tabCounter );
  console.log(tabCounter)
   tabs.tabs( "option", "active", tabCounter );
  
   tabCounter++;
   
   $(".tm-input").tagsManager();
   
}
 


function init(){

	 
	  
	  generateCsvMenu("team",$("#teams").val())
	  
	     $( "#team" ).selectmenu({
	  change: function( event, data ) {
		  updatelogfilesmenu();
		  
	  }

	  });
	  
	  
	  //set radio button
	  
	  $( "#merge" ).buttonset();
	  
	  
	  

	  //Set Button for monitor
	  
	  //set vertical tabs
	  
	    
	    updatelogfilesmenu();
	  
	    $( ".btnstartmonitor" ).button( {
	        icons: {
	          primary: "ui-icon-transferthick-e-w"
	        }
	      });
	    
	    
	     tabs =$( "#tabs" ).tabs()
 	 
		   tabs.addClass( "ui-tabs-vertical ui-helper-clearfix" );
		    $( "#tabs li" ).removeClass( "ui-corner-top" ).addClass( "ui-corner-left" );
		    
		   

	    $( ".btnstartmonitor" ).click(function( event ) {
	    	 
	    	//Set team and 
	    	
	    	var hostfileids=""
	    	
	    	
	    	  if($("select#logfiles").multipleSelect('getSelects').length >0){
	  			
	  			
	    		  var hostlist=new Array();
	    		  
	    		  
	    		 var mergedhosts= $("select#logfiles").multipleSelect('getSelects').join(",")
	  			
	    		 hostlist.push(mergedhosts)
	  			//TODO  $("input#mergeon").attr("Selected")
	  			
	  			 $(hostlist).each(function(index){
	  				 
	  				var formdata="team=" + $("#team").val() +"&hostfileids=" + encodeURI(hostlist[index]);
	  				$.post( "/services/startsession", formdata)
				 	  .done(function( data ) {
				 	    
				 		//parse xml
				 		  $xml = $( data )
				 		  $status = $xml.find( "status" )
				 		  
				 		  
				 		  
				 		  if( $status.attr("error") =="true"){
				 			  
				 			//  showerror("resultdetailcontainer",$status.attr("description"))
				 			  
				 		  } else{
				 			  var localsessionid=$status.attr("sessionid")
				 			  
				 				createtab(localsessionid)
				 				
				 				 setTimeout(function(){ pollog(localsessionid); }, 5000);
				 			 
				 		  }
				 		 
				 	  });
	  				
	  				
	  			 });
	  			 }
	  			
	  			
	  			
	  		else{
	  			
	  			
	  		        alert( "Host should be selected" );
	  		        
	  		
	  		}
	    	
	    	
			
			
			
		 	  
	    	
	    	
	      
	    	
	    })


	     
	    
	    
	    tabs.delegate( "span.ui-icon-close", "click", function() {
	        var panelId = $( this ).closest( "li" ).remove().attr( "aria-controls" );
	        $( "#" + panelId ).remove();
	        tabs.tabs( "refresh" );
	      });
	   
	      tabs.bind( "keyup", function( event ) {
	        if ( event.altKey && event.keyCode === $.ui.keyCode.BACKSPACE ) {
	          var panelId = tabs.find( ".ui-tabs-active" ).remove().attr( "aria-controls" );
	          $( "#" + panelId ).remove();
	          tabs.tabs( "refresh" );
	        }
	      });
	
	
}



  $(function() {
	  
	 
	  
	  init();
	      
	  

  });
  </script>